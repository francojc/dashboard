<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="refresh" content="{{ config.refresh_interval | default(900) }}">
    <title>Dashboard</title>
    <link rel="stylesheet" href="/static/styles.css">
</head>
<body>
    <div class="dashboard-container">
        <!-- Time Display - Top Left -->
        <header class="dashboard-header">
            <div class="current-time">{{ current_time | default('12:05') }}</div>
        </header>

        <!-- Date Display - Top Right -->
        <div class="current-date">
            <div class="day-name">{{ day_name | default('Friday') }}</div>
            <div class="date-info">{{ date_info | default('July 4') }}</div>
        </div>

        <!-- Alert banner (conditional) -->
        {% if alert %}
        <div class="alert-banner">
            <span class="alert-icon">{{ alert.icon | default('⚠️') }}</span>
            <span>{{ alert.text }}</span>
            <span>{{ alert.time | default('') }}</span>
        </div>
        {% endif %}

        <!-- Weather section with forecast -->
        <section class="weather-main">
            <!-- Current weather -->
            {% if weather %}
            <div class="weather-current">
                <div class="weather-main-info">
                    <img src="https://openweathermap.org/img/wn/{{ weather.icon }}@4x.png" 
                         alt="{{ weather.description }}" class="weather-icon">
                    <div class="weather-temp-main">{{ weather.temp }}°</div>
                </div>
                <div class="weather-details">
                    <div class="weather-detail">
                        <span class="weather-detail-icon">○</span>
                        <span>{{ weather.wind_speed }} {{ weather.wind_dir | default('wnw') }}</span>
                    </div>
                    <div class="weather-detail">
                        <span class="weather-detail-icon">☉</span>
                        <span>{{ weather.sunrise | default('8:05') }}</span>
                    </div>
                </div>
            </div>
            {% else %}
            <div class="weather-current">
                <div class="weather-main-info">
                    <div class="weather-icon">☀</div>
                    <div class="weather-temp-main">95°</div>
                </div>
                <div class="weather-details">
                    <div class="weather-detail">
                        <span class="weather-detail-icon">○</span>
                        <span>7 wnw</span>
                    </div>
                    <div class="weather-detail">
                        <span class="weather-detail-icon">☉</span>
                        <span>8:05</span>
                    </div>
                </div>
            </div>
            {% endif %}
            
            <!-- Weather forecast -->
            <div class="weather-forecast">
                    {% if forecast %}
                    {% for day in forecast %}
                    <div class="forecast-day">
                        <div class="forecast-day-name">{{ day.day }}</div>
                        <img src="https://openweathermap.org/img/wn/{{ day.icon }}@2x.png" 
                             alt="{{ day.description }}" class="forecast-icon">
                        <div class="forecast-temps">
                            <span class="forecast-high">{{ day.high }}°</span>
                            <span class="forecast-low">{{ day.low }}°</span>
                        </div>
                    </div>
                    {% endfor %}
                    {% else %}
                    <div class="forecast-day">
                        <div class="forecast-day-name">TODAY</div>
                        <div class="forecast-icon">☀</div>
                        <div class="forecast-temps">
                            <span class="forecast-high">95°</span>
                            <span class="forecast-low">64°</span>
                        </div>
                    </div>
                    <div class="forecast-day">
                        <div class="forecast-day-name">SAT</div>
                        <div class="forecast-icon">☀</div>
                        <div class="forecast-temps">
                            <span class="forecast-high">104°</span>
                            <span class="forecast-low">64°</span>
                        </div>
                    </div>
                    <div class="forecast-day">
                        <div class="forecast-day-name">SUN</div>
                        <div class="forecast-icon">☀</div>
                        <div class="forecast-temps">
                            <span class="forecast-high">107°</span>
                            <span class="forecast-low">64°</span>
                        </div>
                    </div>
                    <div class="forecast-day">
                        <div class="forecast-day-name">MON</div>
                        <div class="forecast-icon">☁</div>
                        <div class="forecast-temps">
                            <span class="forecast-high">88°</span>
                            <span class="forecast-low">62°</span>
                        </div>
                    </div>
                    <div class="forecast-day">
                        <div class="forecast-day-name">TUE</div>
                        <div class="forecast-icon">☀</div>
                        <div class="forecast-temps">
                            <span class="forecast-high">91°</span>
                            <span class="forecast-low">66°</span>
                        </div>
                    </div>
                    {% endif %}
            </div>
        </section>

        <!-- Calendar/Tasks section -->
        <section class="calendar-widget">
                    {% if events %}
                    {% for event in events %}
                    <div class="task-item">
                        <div class="task-checkbox{% if event.completed %} checked{% endif %}"></div>
                        <div class="task-text">{{ event.summary }}</div>
                        {% if event.date %}
                        <div class="task-date">{{ event.date }}</div>
                        {% endif %}
                    </div>
                    {% endfor %}
                    {% else %}
                    <div class="task-item">
                        <div class="task-checkbox"></div>
                        <div class="task-text">Pickup dry cleaning</div>
                    </div>
                    <div class="task-item">
                        <div class="task-checkbox"></div>
                        <div class="task-text">Take out Recycling</div>
                        <div class="task-date">Jul 22</div>
                    </div>
                    <div class="task-item">
                        <div class="task-checkbox checked"></div>
                        <div class="task-text">Walk the dog</div>
                    </div>
                    {% endif %}
        </section>

        <!-- News section -->
        <section class="news-widget">
                    {% if articles %}
                    {% for article in articles[:3] %}
                    <div class="news-item">
                        <div class="news-source">{{ article.source }}</div>
                        <div class="news-title">{{ article.title }}</div>
                        {% if article.summary %}
                        <div class="news-summary">{{ article.summary[:120] }}...</div>
                        {% endif %}
                    </div>
                    {% endfor %}
                    {% else %}
                    <div class="news-item">
                        <div class="news-source">Financial News</div>
                        <div class="news-title">Other grocery stocks plummet as Amazon buys W...</div>
                        <div class="news-summary">Amazon scared investors away from competing grocery stores today when it acq...</div>
                    </div>
                    {% endif %}
        </section>

        <!-- Footer -->
        <footer class="dashboard-footer">
            <p>Last updated: {{ last_updated }}</p>
        </footer>
    </div>

    <script>
        // Update time every second
        function updateTime() {
            const now = new Date();
            const timeStr = now.toLocaleTimeString('en-US', { 
                hour: 'numeric', 
                minute: '2-digit', 
                hour12: false 
            });
            const timeEl = document.querySelector('.current-time');
            if (timeEl) {
                timeEl.textContent = timeStr;
            }
            
            const dayNames = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
            const monthNames = ['January', 'February', 'March', 'April', 'May', 'June',
                'July', 'August', 'September', 'October', 'November', 'December'];
            
            const dayEl = document.querySelector('.day-name');
            const dateEl = document.querySelector('.date-info');
            
            if (dayEl) {
                dayEl.textContent = dayNames[now.getDay()];
            }
            
            if (dateEl) {
                dateEl.textContent = monthNames[now.getMonth()] + ' ' + now.getDate();
            }
        }
        
        // Update immediately and then every second
        updateTime();
        setInterval(updateTime, 1000);
    </script>
</body>
</html>